<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Audio Player</title>
  <style>
    body {
      margin: 0;
      background-color: black;
    }
    .player {
      width: 940px;
      height: 128px;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 20px 10px black;
      display: none;
    }
  </style>
</head>
<body>

<div id="playerContainer"></div>

<script>
  const container = document.getElementById('playerContainer');
  const PRIMARY_URL = "https://fmcloud.pro/embed.php?id=347&autoplay=true";
  const BACKUP_URL = "https://trolltrolli.github.io/skt/popis/hl2/player_backup.html?autoplay=true";

  let playerIsPlaying = false;  // Flag pro detekci přehrávání

  function loadIframe(src, onLoadCallback = null) {
    const iframe = document.createElement('iframe');
    iframe.src = src;
    iframe.allow = "autoplay";
    iframe.className = "player";
    iframe.style.display = 'block';
    if (onLoadCallback) iframe.onload = onLoadCallback;
    container.appendChild(iframe);
    return iframe;
  }

  function removeAllIframes() {
    container.innerHTML = "";
  }

  // Funkce pro detekci přehrávání v iframe
  function detectPlayback(iframe) {
    try {
      // Pokud máme přístup k audio elementu uvnitř iframe, zkusíme zjistit, jestli je přehráváno
      const audio = iframe.contentDocument?.querySelector('audio');
      if (audio && typeof audio.play === 'function') {
        audio.play().then(() => {
          console.log("Autoplay v iframe OK.");
          playerIsPlaying = true;  // Pokud se přehrávání spustí
        }).catch((err) => {
          console.warn("Autoplay selhal (možná blokováno):", err);
          playerIsPlaying = false;  // Pokud autoplay selže
        });
      } else {
        playerIsPlaying = false;  // Když není audio nebo není možné spustit
      }
    } catch (e) {
      console.warn("Nemůžu přistoupit k iframe (CORS):", e);
      playerIsPlaying = false;  // Pokud CORS blokuje přístup
    }
  }

  async function loadPlayerWithFailsafe() {
    console.log("Načítám FMCloud přehrávač...");
    removeAllIframes();  // Zpočátku vymažeme případně přítomné iframy

    const iframe = loadIframe(PRIMARY_URL, () => {
      console.log("FMCloud iframe načten.");
    });

    // Čekáme 3 sekundy na spuštění přehrávání
    await new Promise(resolve => setTimeout(resolve, 3000));

    detectPlayback(iframe);  // Detekujeme, jestli přehrávač začne hrát

    if (playerIsPlaying) {
      console.log("FMCloud přehrávač hraje, vše OK.");
    } else {
      console.warn("FMCloud nehraje, přepínám na záložní přehrávač.");
      removeAllIframes();
      loadIframe(BACKUP_URL);  // Pokud FMCloud nehraje, přepneme na záložní
    }
  }

  // Načteme přehrávač
  loadPlayerWithFailsafe();
</script>

</body>
</html>
